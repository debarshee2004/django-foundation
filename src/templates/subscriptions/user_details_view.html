{% extends 'dashboard/bash.html' %} {% load static %} {% block head_title
%}Subscription Management - {{ block.super }}{% endblock head_title %} {% block
content %}
<div class="p-6 space-y-6">
  <!-- Header -->
  <div class="bg-white rounded-lg shadow-lg p-6 border border-gray-200">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold text-gray-900">
          Subscription Management
        </h1>
        <p class="text-gray-600 mt-2">
          Manage your subscription, billing, and plan details
        </p>
      </div>
      <div class="text-right">
        {% if subscription.is_active_status %}
        <span
          class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800"
        >
          {{ subscription.status|title }}
        </span>
        {% else %}
        <span
          class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800"
        >
          {{ subscription.status|title|default:"No Active Plan" }}
        </span>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Current Subscription Details -->
  <div class="bg-white rounded-lg shadow-lg p-6 border border-gray-200">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-xl font-semibold text-gray-900">Current Plan</h2>
      <form method="POST" class="inline">
        {% csrf_token %}
        <input type="hidden" name="action" value="refresh" />
        <button
          type="submit"
          class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium transition-colors"
        >
          <svg
            class="w-4 h-4 inline mr-2"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"
              clip-rule="evenodd"
            ></path>
          </svg>
          Refresh Data
        </button>
      </form>
    </div>

    {% if subscription.plan_name %}
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Plan Information -->
      <div class="space-y-4">
        <h3 class="text-lg font-medium text-gray-800">Plan Information</h3>
        <div class="bg-gray-50 rounded-lg p-4 space-y-3">
          <div class="flex justify-between">
            <span class="text-gray-600">Plan Name:</span>
            <span class="font-medium">{{ subscription.plan_name }}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Status:</span>
            <span class="font-medium">
              {% if subscription.is_active_status %}
              <span class="text-green-600"
                >{{ subscription.status|title }}</span
              >
              {% else %}
              <span class="text-red-600">{{ subscription.status|title }}</span>
              {% endif %}
            </span>
          </div>
          {% if subscription.original_period_start %}
          <div class="flex justify-between">
            <span class="text-gray-600">Member Since:</span>
            <span class="font-medium"
              >{{ subscription.original_period_start|timesince }} ago</span
            >
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Billing Information -->
      <div class="space-y-4">
        <h3 class="text-lg font-medium text-gray-800">Billing Information</h3>
        <div class="bg-gray-50 rounded-lg p-4 space-y-3">
          {% if subscription.current_period_start %}
          <div class="flex justify-between">
            <span class="text-gray-600">Current Period:</span>
            <span class="font-medium"
              >{{ subscription.current_period_start|date:"M d, Y" }}</span
            >
          </div>
          {% endif %} {% if subscription.current_period_end %}
          <div class="flex justify-between">
            <span class="text-gray-600">
              {% if subscription.cancel_at_period_end %} Cancels On: {% else %}
              Next Billing: {% endif %}
            </span>
            <span class="font-medium">
              {{ subscription.current_period_end|timeuntil }} ({{
              subscription.current_period_end|date:"M d, Y" }})
            </span>
          </div>
          {% endif %} {% if subscription.cancel_at_period_end %}
          <div class="bg-yellow-50 border border-yellow-200 rounded p-3">
            <p class="text-yellow-800 text-sm">
              ⚠️ Your subscription will be cancelled at the end of the current
              billing period.
            </p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="mt-6 flex flex-wrap gap-4">
      {% if subscription.is_active_status and not
      subscription.cancel_at_period_end %}
      <a
        href="{{ subscription.get_cancel_url }}"
        class="bg-red-50 hover:bg-red-100 text-red-700 border border-red-200 px-4 py-2 rounded-lg font-medium transition-colors"
      >
        Cancel Subscription
      </a>
      {% endif %}

      <a
        href="{% url 'customers:billing_portal' %}"
        class="bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 px-4 py-2 rounded-lg font-medium transition-colors"
      >
        Manage Billing
      </a>

      <a
        href="{% url 'pricing' %}"
        class="bg-gray-50 hover:bg-gray-100 text-gray-700 border border-gray-200 px-4 py-2 rounded-lg font-medium transition-colors"
      >
        View All Plans
      </a>
    </div>

    {% else %}
    <!-- No Active Subscription -->
    <div class="text-center py-8">
      <div class="text-gray-500 mb-4">
        <svg
          class="w-16 h-16 mx-auto mb-4"
          fill="currentColor"
          viewBox="0 0 20 20"
        >
          <path
            fill-rule="evenodd"
            d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
            clip-rule="evenodd"
          ></path>
        </svg>
        <h3 class="text-lg font-medium text-gray-900 mb-2">
          No Active Subscription
        </h3>
        <p class="text-gray-600">You don't have an active subscription yet.</p>
      </div>
      <a
        href="{% url 'pricing' %}"
        class="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
      >
        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
          <path
            d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6z"
          ></path>
        </svg>
        Choose a Plan
      </a>
    </div>
    {% endif %}
  </div>

  <!-- Available Plans for Upgrade/Downgrade -->
  {% if subscription.plan_name and available_plans %}
  <div class="bg-white rounded-lg shadow-lg p-6 border border-gray-200">
    <h2 class="text-xl font-semibold text-gray-900 mb-4">Available Plans</h2>
    <p class="text-gray-600 mb-6">Upgrade or change your plan at any time</p>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for plan in available_plans %} {% if plan.subscription.id !=
      subscription.subscription.id %}
      <div
        class="border border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors"
      >
        <h3 class="font-semibold text-lg">{{ plan.display_sub_name }}</h3>
        <p class="text-2xl font-bold text-blue-600 my-2">
          ${{ plan.price }}<span class="text-sm text-gray-500"
            >/{{ plan.interval }}</span
          >
        </p>
        {% if plan.display_sub_subtitle %}
        <p class="text-gray-600 text-sm mb-4">
          {{ plan.display_sub_subtitle }}
        </p>
        {% endif %}
        <a
          href="{{ plan.get_checkout_url }}"
          class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-center block transition-colors"
        >
          {% if plan.price >
          subscription.subscription.subscriptionprice_set.first.price %} Upgrade
          {% else %} Change Plan {% endif %}
        </a>
      </div>
      {% endif %} {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Support Section -->
  <div class="bg-gray-50 rounded-lg p-6">
    <h2 class="text-lg font-semibold text-gray-900 mb-4">Need Help?</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <a
        href="{% url 'customers:support_center' %}"
        class="flex items-center p-4 bg-white rounded-lg border border-gray-200 hover:border-blue-300 transition-colors"
      >
        <svg
          class="w-8 h-8 text-blue-600 mr-4"
          fill="currentColor"
          viewBox="0 0 20 20"
        >
          <path
            fill-rule="evenodd"
            d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-2 0c0 .993-.241 1.929-.668 2.754l-1.524-1.525a3.997 3.997 0 00.078-2.183l1.562-1.562C15.802 8.249 16 9.1 16 10z"
            clip-rule="evenodd"
          ></path>
        </svg>
        <div>
          <h3 class="font-medium">Contact Support</h3>
          <p class="text-gray-600 text-sm">Get help with your subscription</p>
        </div>
      </a>
      <a
        href="{% url 'dashboard:main' %}"
        class="flex items-center p-4 bg-white rounded-lg border border-gray-200 hover:border-blue-300 transition-colors"
      >
        <svg
          class="w-8 h-8 text-blue-600 mr-4"
          fill="currentColor"
          viewBox="0 0 20 20"
        >
          <path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z"></path>
          <path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z"></path>
        </svg>
        <div>
          <h3 class="font-medium">Dashboard</h3>
          <p class="text-gray-600 text-sm">Return to your dashboard</p>
        </div>
      </a>
    </div>
  </div>
</div>
{% endblock content %}
